<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/CSS/principal.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Regimed | Principal</title>
    <link rel="icon" href="/img/Logo/LogoPositive.png" type="image/png">
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"
        integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script defer src="JS/datosPersonales.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script defer src="JS/agregarRegistro.js"></script>
    <script defer src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script defer src="JS/tarjetaDatos.js"></script>
    <script defer src="JS/registroDoctor.js"></script>
    <script defer src="JS/interfazUsuario.js"></script>
    <script defer src="JS/verificacionTelefono.js"></script>
</head>

<body>
    <div id="informacion-general" class="contenido">
        <!-- Aside -->
        <aside>
            <div class="superior">
                <div class="logo" class="aside__imagen">
                    <a href="/"><img src="/img/Logo/LogoCompPositive.png" alt=""></a>
                </div>
                <ul>
                    <li>
                        <a href="#informacion-general" class="opcion seleccionado">
                            <i class="fa-solid fa-user"></i>
                            <p>Información</p>
                        </a>
                    </li>
                    <li>
                        <a href="#vacunas" class="opcion">
                            <i class="fa-solid fa-syringe"></i>
                            <p>Vacunas</p>
                        </a>
                    </li>
                    <li>
                        <a href="#historial" class="opcion">
                            <i class="fa-solid fa-file-medical"></i>
                            <p>Historial médico</p>
                        </a>
                    </li>
                    <li>
                        <a href="#enfermedades" class="opcion">
                            <i class="fa-solid fa-star-of-life"></i>
                            <p>Recetas médicas</p>
                        </a>
                    </li>
                    <li>
                        <a href="#registros" class="opcion">
                            <i class="fa-solid fa-user-group"></i>
                            <p>Registros</p>
                        </a>
                    </li>
                </ul>
            </div>
        </aside>
        <div class="contenidoGeneral">
            <nav>
                <a href="/"><img class="nav__logo" src="/img/Logo/LogoCompPositive.png" alt=""></a>
                <ul class="nav__enlaces">
                  <li><a class="nav__enlace" href="/" id="navInicio">Inicio</a></li>
                  <% if (sesion) {%>
                  <li>
                    <a class="nav__enlace" href="/principal" id="navPerfil">Perfil</a>
                  </li>
                  <li>
                    <a class="nav__enlace" href="/cerrarSesion">Cerrar Sesión</a>
                  </li>
                  <%} else {%>
                  <li>
                    <a class="nav__enlace" href="/registro">Registrate</a>
                  </li>
                  <li>
                    <a class="nav__enlace nav__enlace--borde" href="/acceso" id="navAcceso">Iniciar sesión</a>
                  </li>
                  <%}%>
                </ul>
              </nav>
              
            <main>
                <div class="seccion">
                    <div class="seccion__titulo">
                        <i class="fa-solid fa-user"></i>
                        <h2>Información General</h2>
                    </div>
                    <div class="seccion__columna seccion__columna--informacion_general">
                        <div class="seccion__fila">
                            <div class="contenedor__titulo">
                                <h3>Datos Personales</h3>
                            </div>
                            <div class="seccion__datosPersonales">
                                <div class="seccion__izquierda">
                                    <div class="contenidoImagen">
                                        <img src="/img/users/<%= imagenAMostrar %>" alt="" id="imagenGuardada">
                                    </div>
                                    <div class="seccion__datoPersonal nombre">
                                        <strong>Nombre</strong>
                                        <% if (typeof nombre !== 'undefined' && nombre !== null && nombre !== '') { %>
                                            <p><%= nombre %></p>
                                        <% } else { %>
                                            <p class="vacio">Vacío</p>
                                        <% } %>
                                    </div>
                                </div>
                                <div class="seccion__derecha">
                                    <div class="seccion__datoPersonal curp">
                                        <strong>CURP</strong>
                                        <% if (typeof curp !== 'undefined' && curp !== null && curp !== '') { %>
                                            <p><%= curp %></p>
                                        <% } else { %>
                                            <p class="vacio">Vacío</p>
                                        <% } %>
                                    </div>
                                    <div class="seccion__datoPersonal telefono">
                                        <strong>Teléfono</strong>
                                        <% if (typeof telefono !== 'undefined' && telefono !== null && telefono !== '') { %>
                                            <p><%= telefono %> <%if (telefonoVerificado === "V") {%><i class="fa-solid fa-circle-check"></i><%}%><%if (telefonoVerificado === "N") {%><i class="fa-solid fa-circle-xmark"></i></i><%}%></p>
                                        <% } else { %>
                                            <p class="vacio">Vacío</p>
                                        <% } %>
                                    </div>
                                    <div class="seccion__multiplesDatosPersonales">
                                        <div class="seccion__divisorDatos">
                                            <div class="seccion__datoPersonal">
                                                <strong>Nacimiento</strong>
                                                <% if (typeof nacimiento !== 'undefined' && nacimiento !== null && nacimiento !== '' && nacimiento !== '0000-00-00') { %>
                                                    <p><%= nacimiento %></p>
                                                <% } else { %>
                                                    <p class="vacio">Vacío</p>
                                                <% } %>                                            
                                            </div>
                                            <div class="seccion__datoPersonal">
                                                <strong>Peso</strong>
                                                <% if (typeof peso !== 'undefined' && peso !== null && peso !== '' && peso !== 0) { %>
                                                    <p><%= peso %> Kg</p>
                                                <% } else { %>
                                                    <p class="vacio">Vacío</p>
                                                <% } %>
                                            </div>
                                            <div class="seccion__datoPersonal">
                                                <strong>IMC</strong>
                                                <% if (typeof peso !== 'undefined' && typeof estatura !== 'undefined' && peso !== null && estatura !== null && peso !== '' && estatura !== '' && peso !== 0 && estatura !== 0) { %>
                                                    <% var imc = peso / (estatura * estatura); %>
                                                    <p><%= imc.toFixed(2) %></p>
                                                <% } else { %>
                                                    <p class="vacio">Vacío</p>
                                                <% } %>                                            
                                            </div>
                                            <div class="seccion__datoPersonal">
                                                <strong>Nacionalidad</strong>
                                                <% if (typeof nacionalidad !== 'undefined' && nacionalidad !== null && nacionalidad !== '') { %>
                                                    <p><%= nacionalidad %></p>
                                                <% } else { %>
                                                    <p class="vacio">Vacío</p>
                                                <% } %>
                                            </div>
                                        </div>
                                        <div class="seccion__divisorDatos">
                                            <div class="seccion__datoPersonal">
                                                <strong>Edad</strong>
                                                <% if (typeof nacimiento !== 'undefined' && nacimiento !== null && nacimiento !== '' && nacimiento !== '0000-00-00') { %>
                                                    <% 
                                                    // Convertir la fecha de nacimiento a objeto Date
                                                    var fechaNacimiento = new Date(nacimiento);
                                                    
                                                    // Calcular la fecha actual
                                                    var fechaActual = new Date();
                                                    
                                                    // Calcular la diferencia de años entre la fecha actual y la fecha de nacimiento
                                                    var edad = fechaActual.getFullYear() - fechaNacimiento.getFullYear();
                                                    
                                                    // Ajustar la edad si aún no se ha cumplido el aniversario de nacimiento este año
                                                    if (fechaActual.getMonth() < fechaNacimiento.getMonth() || (fechaActual.getMonth() === fechaNacimiento.getMonth() && fechaActual.getDate() < fechaNacimiento.getDate())) {
                                                        edad--;
                                                    }
                                                    %>
                                                    <p><%= edad %> años</p>
                                                <% } else { %>
                                                    <p class="vacio">Vacío</p>
                                                <% } %>
                                                
                                            </div>
                                            <div class=" seccion__datoPersonal">
                                                <strong>Estatura</strong>
                                                <% if (typeof estatura !== 'undefined' && estatura !== null && estatura !== '' && estatura !== 0) { %>
                                                    <p><%= estatura %> m</p>
                                                <% } else { %>
                                                    <p class="vacio">Vacío</p>
                                                <% } %>
                                            </div>
                                            <div class="seccion__datoPersonal">
                                                <strong>Sexo</strong>
                                                <% if (typeof sexo !== 'undefined' && sexo !== null && sexo !== '') { %>
                                                    <p><%= sexo %></p>
                                                <% } else { %>
                                                    <p class="vacio">Vacío</p>
                                                <% } %>
                                            </div>
                                            <div class="seccion__datoPersonal">
                                                <strong>Tipo de sangre</strong>
                                                <% if (typeof sangre !== 'undefined' && sangre !== null && sangre !== '') { %>
                                                    <p><%= sangre %></p>
                                                <% } else { %>
                                                    <p class="vacio">Vacío</p>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- <form action="inicio.php" method="post" class="contenedor contactos">
                            <div class="titulo-contenedor">
                                <h3>Contactos de emergencia</h3>
                                <button type="submit" name="editar-contactos" class="boton-datos">
                                    <i class='fa-solid fa-pen-to-square'></i>&nbsp;
                                    <?php echo $_SESSION['editar-contactos'] == 0 && !isset($_POST['agregar-contacto']) ? 'Editar información' : 'Guardar información' ?>
                                </button>
                            </div>
                            <div class="tabla">
                                <table>
                                    <tr class="superior">
                                        <th>No. teléfono</th>
                                        <th>Nombre</th>
                                        <th>Relación</th>
                                        <?php echo $_SESSION['editar-contactos'] == 1 ? "<th>Acción</th>" : "" ?>
                                    </tr>
                                    <?php echo isset($_POST['agregar-contacto']) ? '
                                    <div class="datos">
                                        <tr>
                                            <td><input type="text" name="telefono_nuevo_contacto" class="telefono_registrado" placeholder="Vacío"></td>
                                            <td><input type="text" name="nombre_nuevo_contacto" class="nombre_registrado" placeholder="Vacío"></td>
                                            <td><select name="relacion_nueva_contacto" id="relacion" class="relacion_registrado" <?php echo ($_SESSION["editar-contactos"] == 0 ? "disabled" : "") ?>>
                                                    <option value="" disabled selected>Selecciona</option>
                                                    <option value="Padre">Padre</option>
                                                    <option value="Madre">Madre</option>
                                                    <option value="Hermano/a">Hermano/a</option>
                                                    <option value="Cónyuge">Cónyuge</option>
                                                    <option value="Pareja">Pareja</option>
                                                    <option value="Tío/a">Tío/a</option>
                                                    <option value="Primo/a">Primo/a</option>
                                                    <option value="Abuelo/a">Abuelo/a</option>
                                                    <option value="Nieto/a">Nieto/a</option>
                                                    <option value="Sobrino/a">Sobrino/a</option>
                                                    <option value="Sobrino/a">Suegro/a</option>
                                                    <option value="Sobrino/a">Yerno/a</option>
                                                    <option value="Sobrino/a">Cuñado/a</option>
                                                    <option value="Sobrino/a">Otro</option>
                                                </select>
                                            </td>
                                            <td class="accion-contacto"><button name="cancelar_agregar-contacto" class="accion-contacto"><i class="fa-solid fa-ban"></i></button></td>
                                        </tr>
                                    </div>' : '' ?>

                                    <?php foreach ($contactos as $contacto) {
                                        $telefono_contacto = preg_replace('/[^0-9]/', '', $contacto['telefono']);
                                        $telefono_contacto = '(' . substr($telefono_contacto, 0, 3) . ') ' . substr($telefono_contacto, 3, 3) . '-' . substr($telefono_contacto, 6);
                                        ?>
                                        <tr>
                                            <td>
                                                <input type="text"
                                                    name="telefono_contacto_<?php echo $contacto['contacto_id'] ?>"
                                                    value="<?php echo $_SESSION['editar-contactos'] == 1 ? $contacto['telefono'] : $telefono_contacto ?>"
                                                    class="datos_guardados telefono_registrado <?php echo $_SESSION['editar-contactos'] == 0 ? 'readonly' : '' ?>"
                                                    <?php echo $_SESSION['editar-contactos'] == 0 ? 'readonly' : '' ?>>
                                            </td>
                                            <td>
                                                <input type="text" name="nombre_contacto_<?php echo $contacto['contacto_id'] ?>"
                                                    value="<?php echo $contacto['nombre'] ?>"
                                                    class="datos_guardados nombre_registrado <?php echo $_SESSION['editar-contactos'] == 0 ? 'readonly' : '' ?>"
                                                    <?php echo $_SESSION['editar-contactos'] == 0 ? 'readonly' : '' ?>>
                                            </td>
                                            <td>
                                                <input type="text"
                                                    name="relacion_contacto_<?php echo $contacto['contacto_id'] ?>"
                                                    value="<?php echo $contacto['relacion'] ?>"
                                                    class="datos_guardados relacion_registrado <?php echo $_SESSION['editar-contactos'] == 0 ? 'readonly' : '' ?>"
                                                    <?php echo $_SESSION['editar-contactos'] == 0 ? 'readonly' : '' ?>>
                                            </td>
                                            <?php if ($_SESSION['editar-contactos'] == 1) { ?>
                                                <td class="accion-contacto">
                                                    <button class="accion-contacto" name="borrar-contacto"
                                                        value="<?php echo $contacto['contacto_id']; ?>">
                                                        <i class="fa-solid fa-trash"></i>
                                                    </button>
                                                </td>
                                            <?php } ?>
                                        </tr>
                                    <?php }
                                    $filas_vacias = ($_SESSION['editar-contactos'] == 1 ? 6 : 7) - $contactos->num_rows;

                                    while ($filas_vacias > 0) {
                                        $filas_vacias--;
                                        ?>
                                        <tr>
                                            <td>&nbsp</td>
                                            <td></td>
                                            <td></td>
                                            <?php echo $_SESSION['editar-contactos'] == 1 ? "<td></td>" : "" ?>
                                        </tr>
                                    <?php } ?>

                                    <?php echo (isset($_POST['editar-contactos']) || isset($_POST['borrar-contacto']) || isset($_POST['cancelar_agregar-contacto'])) && $_SESSION['editar-contactos'] == 1 ? '<tr class="inferior">
                                        <td colspan="4" class="abajo">
                                            <button type="submit" name="agregar-contacto" class="agregar-contacto boton-datos">
                                                Agregar contacto
                                                <i class="fa-solid fa-user-plus"></i>
                                            </button>
                                        </td>
                                    </tr>' : '' ?>
                                </table>
                            </div>
                        </form> -->
                </div>
                <div class="seccion vacunas" id="vacunas">
                    <div class="seccion__titulo">
                        <i class="fa-solid fa-syringe"></i>
                        <h2>Vacunas</h2>
                    </div>
                    <div class="seccion__columna">
                        <div class="contenedor vacunas-preestablecidas">
                            <h3>Vacunas preestablecidas</h3>
                            <div class="tabla">
                                <table>
                                    <tr class="superior">
                                        <th>Vacuna</th>
                                        <th>Enfermedad que previene</th>
                                        <th>Dosis</th>
                                        <th>Edad y frecuencia</th>
                                        <th>Fecha de vacunación</th>
                                    </tr>
                                    <tr>
                                        <td class="bcg">BCG</td>
                                        <td>Tuberculosis</td>
                                        <td>Única</td>
                                        <td>Al nacer</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_bcg = new Date(vacunasPreestablecidas[0].fecha_bcg); %>
                                            <% if (!isNaN(fecha_bcg.getTime())) { %>
                                                <td><%= fecha_bcg.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td class="hepatitis-b" rowspan="3">Hepatitis B</td>
                                        <td rowspan="3">Hepatitis B</td>
                                        <td>Primera</td>
                                        <td>Al nacer</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_hepatitisb1 = new Date(vacunasPreestablecidas[0].fecha_hepatitisb1); %>
                                            <% if (!isNaN(fecha_hepatitisb1.getTime())) { %>
                                                <td><%= fecha_hepatitisb1.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td>Segunda</td>
                                        <td>2 meses</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_hepatitisb1 = new Date(vacunasPreestablecidas[0].fecha_hepatitisb2); %>
                                            <% if (!isNaN(fecha_hepatitisb1.getTime())) { %>
                                                <td><%= fecha_hepatitisb1.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td>Tercera</td>
                                        <td>6 meses</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_hepatitisb3 = new Date(vacunasPreestablecidas[0].fecha_hepatitisb3); %>
                                            <% if (!isNaN(fecha_hepatitisb3.getTime())) { %>
                                                <td><%= fecha_hepatitisb3.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td class="pentavalente" rowspan="4">Pentavalente Acelular DPat +VPI + Hib</td>
                                        <td rowspan="4">Difteria, tos ferina, tétanos, poliomielitis e infecciones por
                                            H. influenzae b</td>
                                        <td>Primera</td>
                                        <td>2 meses</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_prevalente1 = new Date(vacunasPreestablecidas[0].fecha_prevalente1); %>
                                            <% if (!isNaN(fecha_prevalente1.getTime())) { %>
                                                <td><%= fecha_prevalente1.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td>Segunda</td>
                                        <td>4 meses</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_prevalente2 = new Date(vacunasPreestablecidas[0].fecha_prevalente2); %>
                                            <% if (!isNaN(fecha_prevalente2.getTime())) { %>
                                                <td><%= fecha_prevalente2.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td>Tercera</td>
                                        <td>6 meses</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_prevalente3 = new Date(vacunasPreestablecidas[0].fecha_prevalente3); %>
                                            <% if (!isNaN(fecha_prevalente3.getTime())) { %>
                                                <td><%= fecha_prevalente3.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td>Cuarta</td>
                                        <td>18 meses</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_prevalente4 = new Date(vacunasPreestablecidas[0].fecha_prevalente4); %>
                                            <% if (!isNaN(fecha_prevalente4.getTime())) { %>
                                                <td><%= fecha_prevalente4.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td class="dpt">DPT</td>
                                        <td>Difteria, tos ferina y tétanos</td>
                                        <td>Refuerzo</td>
                                        <td>4 años</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_dpt = new Date(vacunasPreestablecidas[0].fecha_dpt); %>
                                            <% if (!isNaN(fecha_dpt.getTime())) { %>
                                                <td><%= fecha_dpt.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td class="rotavirus" rowspan="3">Rotavirus</td>
                                        <td rowspan="3">Diarrea por rotavirus</td>
                                        <td>Primera</td>
                                        <td>2 meses</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_rotavirus1 = new Date(vacunasPreestablecidas[0].fecha_rotavirus1); %>
                                            <% if (!isNaN(fecha_rotavirus1.getTime())) { %>
                                                <td><%= fecha_rotavirus1.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td>Segunda</td>
                                        <td>4 meses</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_rotavirus2 = new Date(vacunasPreestablecidas[0].fecha_rotavirus2); %>
                                            <% if (!isNaN(fecha_rotavirus2.getTime())) { %>
                                                <td><%= fecha_rotavirus2.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td>Tercera</td>
                                        <td>6 meses</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_rotavirus3 = new Date(vacunasPreestablecidas[0].fecha_rotavirus3); %>
                                            <% if (!isNaN(fecha_rotavirus3.getTime())) { %>
                                                <td><%= fecha_rotavirus3.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td class="neumococica" rowspan="3">Neumocócica conjugada</td>
                                        <td rowspan="3">Infecciones por neumococo</td>
                                        <td>Primera</td>
                                        <td>2 meses</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_neumococica1 = new Date(vacunasPreestablecidas[0].fecha_neumococica1); %>
                                            <% if (!isNaN(fecha_neumococica1.getTime())) { %>
                                                <td><%= fecha_neumococica1.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td>Segunda</td>
                                        <td>4 meses</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_neumococica2 = new Date(vacunasPreestablecidas[0].fecha_neumococica2); %>
                                            <% if (!isNaN(fecha_neumococica2.getTime())) { %>
                                                <td><%= fecha_neumococica2.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td>Refuerzo</td>
                                        <td>12 meses</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_neumococica3 = new Date(vacunasPreestablecidas[0].fecha_neumococica3); %>
                                            <% if (!isNaN(fecha_neumococica3.getTime())) { %>
                                                <td><%= fecha_neumococica3.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td class="influenza" rowspan="3">Influenza</td>
                                        <td rowspan="3">Influenza</td>
                                        <td>Primera</td>
                                        <td>6 meses</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_influenza1 = new Date(vacunasPreestablecidas[0].fecha_influenza1); %>
                                            <% if (!isNaN(fecha_influenza1.getTime())) { %>
                                                <td><%= fecha_influenza1.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td>Segunda</td>
                                        <td>7 meses</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_influenza2 = new Date(vacunasPreestablecidas[0].fecha_influenza2); %>
                                            <% if (!isNaN(fecha_influenza2.getTime())) { %>
                                                <td><%= fecha_influenza2.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td>Revacunación</td>
                                        <td>Anual hasta los 59 meses</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_influenza3 = new Date(vacunasPreestablecidas[0].fecha_influenza3); %>
                                            <% if (!isNaN(fecha_influenza3.getTime())) { %>
                                                <td><%= fecha_influenza3.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td class="srp" rowspan="2">SRP</td>
                                        <td rowspan="2">Sarampión, rubéola y parotiditis</td>
                                        <td>Primera</td>
                                        <td>1 año</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_srp1 = new Date(vacunasPreestablecidas[0].fecha_srp1); %>
                                            <% if (!isNaN(fecha_srp1.getTime())) { %>
                                                <td><%= fecha_srp1.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td>Reguerzo</td>
                                        <td>6 años</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_srp2 = new Date(vacunasPreestablecidas[0].fecha_srp2); %>
                                            <% if (!isNaN(fecha_srp2.getTime())) { %>
                                                <td><%= fecha_srp2.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td class="sabin" rowspan="8">Sabin</td>
                                        <td rowspan="8">Poliomielitis</td>
                                        <td rowspan="8" colspan="2">Adicionales</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_sabin1 = new Date(vacunasPreestablecidas[0].fecha_sabin1); %>
                                            <% if (!isNaN(fecha_sabin1.getTime())) { %>
                                                <td><%= fecha_sabin1.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_sabin2 = new Date(vacunasPreestablecidas[0].fecha_sabin2); %>
                                            <% if (!isNaN(fecha_sabin2.getTime())) { %>
                                                <td><%= fecha_sabin2.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_sabin3 = new Date(vacunasPreestablecidas[0].fecha_sabin3); %>
                                            <% if (!isNaN(fecha_sabin3.getTime())) { %>
                                                <td><%= fecha_sabin3.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_sabin4 = new Date(vacunasPreestablecidas[0].fecha_sabin4); %>
                                            <% if (!isNaN(fecha_sabin4.getTime())) { %>
                                                <td><%= fecha_sabin4.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                        
                                    </tr>
                                    <tr>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_sabin5 = new Date(vacunasPreestablecidas[0].fecha_sabin5); %>
                                            <% if (!isNaN(fecha_sabin5.getTime())) { %>
                                                <td><%= fecha_sabin5.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_sabin6 = new Date(vacunasPreestablecidas[0].fecha_sabin6); %>
                                            <% if (!isNaN(fecha_sabin6.getTime())) { %>
                                                <td><%= fecha_sabin6.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_sabin7 = new Date(vacunasPreestablecidas[0].fecha_sabin7); %>
                                            <% if (!isNaN(fecha_sabin7.getTime())) { %>
                                                <td><%= fecha_sabin7.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_sabin8 = new Date(vacunasPreestablecidas[0].fecha_sabin8); %>
                                            <% if (!isNaN(fecha_sabin8.getTime())) { %>
                                                <td><%= fecha_sabin8.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                    <tr>
                                        <td class="sr">SR</td>
                                        <td>Sarampión y rubéola</td>
                                        <td colspan="2">Adicionales</td>
                                        <% if (vacunasPreestablecidas && vacunasPreestablecidas.length > 0) { %>
                                            <% const fecha_sr = new Date(vacunasPreestablecidas[0].fecha_sr); %>
                                            <% if (!isNaN(fecha_sr.getTime())) { %>
                                                <td><%= fecha_sr.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="contenedor otras-vacunas">
                            <h3>Otras vacunas</h3>
                            <div class="tabla">
                                <table>
                                    <tr class="superior">
                                        <th>Vacuna</th>
                                        <th>Enfermedad que previene</th>
                                        <th>Dosis</th>
                                        <th>Edad y frecuencia</th>
                                        <th>Fecha de vacunación</th>
                                    </tr>
                                    <tr>
                                        <% if (otrasVacunas && otrasVacunas.length > 0) { %>
                                        <td><%= otrasVacunas[0].nombre %></td>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                        <% if (otrasVacunas && otrasVacunas.length > 0) { %>
                                            <td><%= otrasVacunas[0].enfermedad_preventiva %></td>
                                            <% } else { %>
                                                <td></td>
                                        <% } %>
                                        <% if (otrasVacunas && otrasVacunas.length > 0) { %>
                                            <td><%= otrasVacunas[0].dosis %></td>
                                            <% } else { %>
                                                <td></td>
                                        <% } %>
                                        <% if (otrasVacunas && otrasVacunas.length > 0) { %>
                                            <td><%= otrasVacunas[0].edad_frecuencia %></td>
                                            <% } else { %>
                                            <td></td>
                                        <% } %>
                                        <% if (otrasVacunas && otrasVacunas.length > 0) { %>
                                            <% const fecha_vacunacion = new Date(otrasVacunas[0].fecha_vacunacion); %>
                                            <% if (!isNaN(fecha_vacunacion.getTime())) { %>
                                                <td><%= fecha_vacunacion.toLocaleDateString('es-ES') %></td>
                                            <% } else { %>
                                                <td></td>
                                            <% } %>
                                        <% } else { %>
                                            <td></td>
                                        <% } %>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="seccion historial" id="historial">
                    <div class="seccion__titulo">
                        <i class="fa-solid fa-file-medical"></i>
                        <h2>Historial médico</h2>
                    </div>
                    <div class="seccion__columna seccion__columna--historial_medico">
                        El paciente ha presentado alguna vez:
                        <div id="formularioHistorialMedico" class="historial_medico">
                            <% historialMedico.forEach(function(dato) { %>
                                <% Object.keys(dato).forEach(function(key) { %>
                                    <% if (dato[key] === 1) { %>
                                        <% const formattedKey = key.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase()); %>
                                        <p>●&nbsp<%= formattedKey.replace(/\b\w+/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();}); %></p>
                                    <% } %>
                                <% }); %>
                            <% }); %>    
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

<!-- * ------------------------ Contenedores ------------------------ * -->
</body>
</html>